<html>

<head>

  <title>{{.Title}} | Performance</title>

  <link rel="stylesheet" href="/static/style.css">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script type="text/javascript">
    google.charts.load('current', { 'packages': ['annotationchart'] });
    google.charts.setOnLoadCallback(drawChart);

    let chart;

    function drawChart() {
      var jsonColumnsData = $.ajax({
        url: "/data/servercontexts/statistics.json",
        headers: { "ID": "{{.ProcessId}}" },
        dataType: "json",
        async: false
      }).responseText;
      var columns = new google.visualization.DataTable(jsonColumnsData);

      var jsonData = $.ajax({
        url: "/data/servercontexts/data.json",
        headers: { "ID": "{{.ProcessId}}" },
        dataType: "json",
        async: false
      }).responseText;
      var data = new google.visualization.DataTable(jsonData);

      table = new google.visualization.Table(document.getElementById('table_div'));
      chart = new google.visualization.AnnotationChart(document.getElementById('chart_div'));

      chart.draw(data, { displayAnnotations: true, interpolateNulls: true, thickness: 5, width: '100%' });
      setColumnColors(columns);
      drawTable(table, columns)

      google.visualization.events.addListener(table, 'select', function () {
        var row = table.getSelection()[0].row;
        var value = columns.getValue(row, 4);

        value = !value;
        columns.setValue(row, 4, value);
        if (value) {
          chart.showDataColumns(row)
        } else {
          chart.hideDataColumns(row)
        }

        drawTable(table, columns);
      });

    }

    function setColumnColors(table) {
      var legends = document.getElementsByClassName("legend-dot");

      for (let i = 0; i < legends.length; i++) {
        table.setProperties(i, 0, { 'style': 'color: ' + legends[i].style.backgroundColor + '; white-space: nowrap;' });
        table.setProperties(i, 4, { 'style': 'color: ' + legends[i].style.backgroundColor + ';' });
      }
    }

    function drawTable(table, data) {
      table.draw(data, { showRowNumber: true, allowHtml: true, width: '100%' });
    }

  </script>
  </script>
</head>

<body>
  {{.DataFilter}}
  {{.Navigation}}

  <div style="width: 100%; height: 100%; display: table;">
    <div style="display: table-row;">
      <div style="display: table-cell;">{{.ProcessList}}</div>
      <div style="display: table-cell;">
        <div style='height: 30px;'><span>{{.Process}}</span></div>
        <div id='chart_div' style='width: 100%; height: 50%;'></div>
        <div id='table_div' style='width: 100%;'></div>
      </div>
    </div>
  </div>

</body>

</html>